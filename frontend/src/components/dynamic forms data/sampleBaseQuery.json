{
  "report_name": "Savings_Personal_Ledger_S",
  "base_query": "SELECT pl_month_tb.id, pl_month_tb.pl_account_id, pl_month_tb.branch_month_id, pl_month_tb.month_debit, pl_month_tb.month_credit, pl_month_tb.paid_interest, pl_month_tb.paid_penalty, pl_month_tb.closing_balance, pl_month_tb.passdue_amount, pl_month_tb.interest_reservation, pl_month_tb.status, pl_account.id, ci_customer.id, pl_account.ci_customer_id, ci_customer.customer_number, pl_account_type.id, pl_account_type.period_max, pl_account_type.period_min, pl_account_type.interest_policy, pl_account_type.interest_update_policy, pl_account_type.interest_rate_max, pl_account_type.interest_rate_min, pl_account_type.penalty_policy, pl_account_type.penalty_rate, pl_account_type.insurance_policy, pl_account_type.insurance_rate, pl_account_type.fee_policy, pl_account_type.fee_rate, pl_account_type.minimum_balance, pl_account_type.field_collection, pl_account_type.allow_interest_edit, pl_account_type.loan_schedule_type, pl_account_type.tax_minimum_balance, pl_account_type.tax_rate, pl_account_type.no_of_loan_guarantor, pl_account_type.passdue_policy, pl_account_type.status, pl_account.pl_account_type_id, pl_month_tb.id, gl_branch.telephone, pl_month_tb.status, it_institute.id, it_institute.email, it_institute.phone, it_institute.reg_num, it_institute.reg_date, it_institute.sms_mask, it_institute.sms_mask_id, it_institute.swift_code, it_institute.status, pl_account_type.it_institute_id, pl_account.open_date, pl_account.reneve_date, pl_account.ref_account_number, it_user_master.id, it_user_master.customer_id, it_user_master.name, it_user_master.status, it_user_master.active_branch_id, pl_account_type.it_institute_id, it_generated_reports.id, it_generated_reports.user_id, it_generated_reports.it_institute_id, it_generated_reports.date_from, it_generated_reports.date_to, it_generated_reports.value_from, it_generated_reports.value_to, it_generated_reports.cash_open, it_generated_reports.cash_closing, it_generated_reports.bank_open, it_generated_reports.bank_closing, it_generated_reports.filter_1_text, it_generated_reports.filter_2_text, it_generated_reports.filter_1_value, it_generated_reports.filter_2_value, pl_account_type.pl_account_category_id, pl_account.status, gl_branch.id, gl_branch.it_institute_id, gl_branch.status, it_institute.name_ln1, it_institute.name_ln2, it_institute.address_ln1, it_institute.name_ln3, it_institute.address_ln2, it_institute.address_ln3, ci_customer.branch_id, ci_customer.full_name_ln1, ci_customer.full_name_ln2, ci_customer.full_name_ln3, ci_customer.ini_name_ln1, ci_customer.ini_name_ln2, ci_customer.ini_name_ln3, ci_customer.address_ln1, ci_customer.address_ln2, ci_customer.address_ln3, pl_account_type.name_ln1, pl_account_type.name_ln2, pl_account_type.name_ln3, gl_branch.name_ln1, gl_branch.name_ln2, gl_branch.name_ln3 FROM pl_month_tb INNER JOIN pl_account ON pl_month_tb.pl_account_id = pl_account.id INNER JOIN ci_customer ON pl_account.ci_customer_id = ci_customer.id INNER JOIN pl_account_type ON pl_account.pl_account_type_id = pl_account_type.id INNER JOIN gl_branch ON pl_account.branch_id = gl_branch.id AND ci_customer.branch_id = gl_branch.id INNER JOIN it_institute ON it_institute.id = gl_branch.it_institute_id, it_generated_reports INNER JOIN it_user_master ON it_user_master.id = it_generated_reports.user_id WHERE pl_month_tb.closing_balance <> 0 AND it_generated_reports.id = $P{parm_a} AND pl_account_type.pl_account_category_id = 1 AND pl_month_tb.branch_month_id = it_generated_reports.filter_2_value AND pl_account.gl_account_id = it_generated_reports.filter_1_value AND pl_account.branch_id = it_generated_reports.branch_id ORDER BY pl_account_type.id ASC, pl_account.ci_customer_id ASC, pl_account.ref_account_number ASC",
  "headings": {
    "main_heading": {
      "expression": "$F{name_ln2}+' - ' +'ශාඛාව ( '+$F{COLUMN_101}",
      "fields": ["it_institute.name_ln2", "gl_branch.name_ln1"],
      "placeholder": "{it_institute.name_ln2} - ශාඛාව ( {gl_branch.name_ln1}",
      "note": "COLUMN_101 maps to gl_branch.name_ln1"
    },
    "sub_heading": {
      "expression": "$P{parm_b}",
      "fields": ["filter_date_range"],
      "placeholder": "Personal Savings Ledger for {filter_date_range}",
      "parameter_name": "parm_b",
      "note": "parm_b is a parameter that typically contains the date range for the personal ledger report"
    }
  },
  "select_fields": [
    "pl_month_tb.id",
    "pl_month_tb.pl_account_id",
    "pl_month_tb.branch_month_id",
    "pl_month_tb.month_debit",
    "pl_month_tb.month_credit",
    "pl_month_tb.paid_interest",
    "pl_month_tb.paid_penalty",
    "pl_month_tb.closing_balance",
    "pl_month_tb.passdue_amount",
    "pl_month_tb.interest_reservation",
    "pl_month_tb.status",
    "pl_account.id",
    "pl_account.ci_customer_id",
    "pl_account.pl_account_type_id",
    "pl_account.open_date",
    "pl_account.reneve_date",
    "pl_account.ref_account_number",
    "pl_account.status",
    "pl_account.branch_id",
    "ci_customer.id",
    "ci_customer.customer_number",
    "ci_customer.branch_id",
    "ci_customer.full_name_ln1",
    "ci_customer.full_name_ln2",
    "ci_customer.full_name_ln3",
    "ci_customer.ini_name_ln1",
    "ci_customer.ini_name_ln2",
    "ci_customer.ini_name_ln3",
    "ci_customer.address_ln1",
    "ci_customer.address_ln2",
    "ci_customer.address_ln3",
    "pl_account_type.id",
    "pl_account_type.period_max",
    "pl_account_type.period_min",
    "pl_account_type.interest_policy",
    "pl_account_type.interest_update_policy",
    "pl_account_type.interest_rate_max",
    "pl_account_type.interest_rate_min",
    "pl_account_type.penalty_policy",
    "pl_account_type.penalty_rate",
    "pl_account_type.insurance_policy",
    "pl_account_type.insurance_rate",
    "pl_account_type.fee_policy",
    "pl_account_type.fee_rate",
    "pl_account_type.minimum_balance",
    "pl_account_type.field_collection",
    "pl_account_type.allow_interest_edit",
    "pl_account_type.loan_schedule_type",
    "pl_account_type.tax_minimum_balance",
    "pl_account_type.tax_rate",
    "pl_account_type.no_of_loan_guarantor",
    "pl_account_type.passdue_policy",
    "pl_account_type.status",
    "pl_account_type.it_institute_id",
    "pl_account_type.pl_account_category_id",
    "pl_account_type.name_ln1",
    "pl_account_type.name_ln2",
    "pl_account_type.name_ln3",
    "gl_branch.id",
    "gl_branch.it_institute_id",
    "gl_branch.telephone",
    "gl_branch.status",
    "gl_branch.name_ln1",
    "gl_branch.name_ln2",
    "gl_branch.name_ln3",
    "it_institute.id",
    "it_institute.email",
    "it_institute.phone",
    "it_institute.reg_num",
    "it_institute.reg_date",
    "it_institute.sms_mask",
    "it_institute.sms_mask_id",
    "it_institute.swift_code",
    "it_institute.status",
    "it_institute.name_ln1",
    "it_institute.name_ln2",
    "it_institute.address_ln1",
    "it_institute.name_ln3",
    "it_institute.address_ln2",
    "it_institute.address_ln3",
    "it_user_master.id",
    "it_user_master.customer_id",
    "it_user_master.name",
    "it_user_master.status",
    "it_user_master.active_branch_id",
    "it_generated_reports.id",
    "it_generated_reports.user_id",
    "it_generated_reports.it_institute_id",
    "it_generated_reports.date_from",
    "it_generated_reports.date_to",
    "it_generated_reports.value_from",
    "it_generated_reports.value_to",
    "it_generated_reports.cash_open",
    "it_generated_reports.cash_closing",
    "it_generated_reports.bank_open",
    "it_generated_reports.bank_closing",
    "it_generated_reports.filter_1_text",
    "it_generated_reports.filter_2_text",
    "it_generated_reports.filter_1_value",
    "it_generated_reports.filter_2_value"
  ],
  "search_fields": [
    "it_generated_reports.id",
    "pl_account_type.pl_account_category_id",
    "pl_month_tb.branch_month_id",
    "pl_account.gl_account_id",
    "pl_account.branch_id"
  ],
  "sort_fields": [
    { "field": "pl_account_type.id", "direction": "ASC" },
    { "field": "pl_account.ci_customer_id", "direction": "ASC" },
    { "field": "pl_account.ref_account_number", "direction": "ASC" }
  ],
  "report_layout_fields": {
    "column_headers": [
      {
        "field": "Serial No",
        "width": 45,
        "alignment": "Center",
        "text": "අ.ක."
      },
      {
        "field": "Customer Number",
        "width": 60,
        "alignment": "Center",
        "text": "ගනුදෙනුකරු අංකය"
      },
      {
        "field": "Customer Name",
        "width": 155,
        "alignment": "Left",
        "text": "ගනුදෙනුකරුගේ නම"
      },
      {
        "field": "Account Number",
        "width": 75,
        "alignment": "Center",
        "text": "ගිණුම"
      },
      {
        "field": "Open Date",
        "width": 70,
        "alignment": "Center",
        "text": "ආරම්භක දිනය"
      },
      { "field": "Balance", "width": 75, "alignment": "Right", "text": "ශේෂය" }
    ],
    "detail_fields": [
      {
        "field": "report_count",
        "type": "variable",
        "source": "$V{REPORT_COUNT}",
        "width": 45,
        "alignment": "Center",
        "format": "#,#00.###;(#,#00.###-)"
      },
      {
        "field": "ci_customer.customer_number",
        "type": "field",
        "width": 60,
        "alignment": "Center"
      },
      {
        "field": "ci_customer.full_name_ln2",
        "type": "field",
        "width": 155,
        "alignment": "Left"
      },
      {
        "field": "pl_account.ref_account_number",
        "type": "field",
        "width": 75,
        "alignment": "Center"
      },
      {
        "field": "pl_account.open_date",
        "type": "field",
        "width": 70,
        "alignment": "Center",
        "format": "yyyy-MM-dd"
      },
      {
        "field": "pl_month_tb.closing_balance",
        "type": "field",
        "width": 75,
        "alignment": "Right",
        "format": "#,##0.00#;(#,##0.00#)"
      }
    ],
    "group_header_fields": [
      {
        "field": "account_type_name",
        "type": "field",
        "source": "pl_account_type.name_ln1",
        "column_reference": "COLUMN_98",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 12,
        "bold": true
      }
    ],
    "group_footer_fields": [
      {
        "field": "group_total_label",
        "type": "static",
        "value": "උප එකතුව",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 12,
        "bold": true,
        "translation": "Sub Total"
      },
      {
        "field": "group_total_balance",
        "type": "variable",
        "source": "closing_balance2",
        "format": "#,##0.00#;(#,##0.00#)",
        "alignment": "Right",
        "font": "Calibri",
        "bold": true
      }
    ],
    "footer_fields": [
      {
        "field": "report_title",
        "type": "static",
        "value": "AI Banker - තැන්පත් ලේඛණය - PL 05",
        "alignment": "Left",
        "font": "Iskoola Pota",
        "size": 7
      },
      {
        "field": "page_number",
        "type": "calculated",
        "expression": "'පිටුව ' + $V{PAGE_NUMBER}",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 7
      },
      {
        "field": "total_pages",
        "type": "calculated",
        "expression": "' සිට  ' + $V{PAGE_NUMBER}",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 7,
        "evaluation_time": "Report"
      },
      {
        "field": "printed_by_label",
        "type": "static",
        "value": "මුද්‍රණය -",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 7
      },
      {
        "field": "user_name",
        "type": "field",
        "source": "it_user_master.name",
        "alignment": "Left",
        "font": "Calibri",
        "size": 7
      },
      {
        "field": "printed_by_closing",
        "type": "static",
        "value": "පරිශීලකයා (",
        "alignment": "Right",
        "font": "FMAbhaya",
        "size": 7
      },
      {
        "field": "print_date",
        "type": "calculated",
        "format": "MMM d, yyyy h:mm:ss a",
        "expression": "new java.util.Date()",
        "alignment": "Right",
        "font": "Calibri",
        "size": 7
      }
    ],
    "summary_fields": [
      {
        "field": "grand_total_label",
        "type": "static",
        "value": "මුළු එකතුව",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 12,
        "bold": true,
        "translation": "Grand Total"
      },
      {
        "field": "grand_total_balance",
        "type": "variable",
        "source": "closing_balance3",
        "format": "#,##0.00#;(#,##0.00#)",
        "alignment": "Right",
        "font": "Calibri",
        "bold": true
      },
      {
        "field": "prepared_by_label",
        "type": "static",
        "value": "සකස්කරන ලද්දේ (",
        "alignment": "Left",
        "font": "FMAbhaya",
        "size": 12,
        "translation": "Prepared By ("
      }
    ]
  },
  "calculated_fields": [
    {
      "name": "customer_account_balance",
      "fields_included": ["pl_month_tb.closing_balance"],
      "calculation_logic": "$F{closing_balance}",
      "description": "Current closing balance for customer personal savings account"
    },
    {
      "name": "account_type_display",
      "fields_included": ["pl_account_type.name_ln1"],
      "calculation_logic": "$F{COLUMN_98}",
      "description": "Display account type name in local language"
    },
    {
      "name": "institute_branch_display",
      "fields_included": ["it_institute.name_ln2", "gl_branch.name_ln1"],
      "calculation_logic": "$F{name_ln2}+' - ' +'ශාඛාව ( '+$F{COLUMN_101}",
      "description": "Combine institute and branch names for header display"
    },
    {
      "name": "account_open_date_formatted",
      "fields_included": ["pl_account.open_date"],
      "calculation_logic": "$F{open_date}",
      "description": "Format account opening date for display",
      "format": "yyyy-MM-dd"
    }
  ],
  "variables": [
    {
      "name": "closing_balance1",
      "class": "java.lang.Double",
      "resetType": "Group",
      "resetGroup": "Group1",
      "calculation": "Sum",
      "expression": "$F{closing_balance}"
    },
    {
      "name": "closing_balance2",
      "class": "java.lang.Double",
      "resetType": "Column",
      "calculation": "Sum",
      "expression": "$F{closing_balance}"
    },
    {
      "name": "closing_balance3",
      "class": "java.lang.Double",
      "calculation": "Sum",
      "expression": "$F{closing_balance}"
    }
  ],
  "parameters": [
    {
      "field": "id",
      "name": "parm_a",
      "class": "java.lang.Integer",
      "reference": "it_generated_reports.id",
      "table": "it_generated_reports",
      "description": "Report ID parameter for filtering specific generated report"
    },
    {
      "field": "date_range",
      "name": "parm_b",
      "class": "java.lang.String",
      "reference": "date_range_display",
      "table": "it_generated_reports",
      "description": "Date range parameter for personal ledger report display"
    }
  ],
  "groups": [
    {
      "name": "Group1",
      "groupExpression": "$F{COLUMN_98}",
      "description": "Group by account type (pl_account_type.name_ln1) to categorize savings accounts",
      "isStartNewPage": true,
      "field_mapping": { "COLUMN_98": "pl_account_type.name_ln1" }
    }
  ],
  "database_tables": [
    {
      "name": "pl_month_tb",
      "alias": "pl_month_tb",
      "description": "Personal loan monthly trial balance with closing balances and transaction details"
    },
    {
      "name": "pl_account",
      "alias": "pl_account",
      "description": "Personal loan account master data including account numbers and dates"
    },
    {
      "name": "ci_customer",
      "alias": "ci_customer",
      "description": "Customer master information including names and addresses"
    },
    {
      "name": "pl_account_type",
      "alias": "pl_account_type",
      "description": "Personal loan account type master with interest rates and policies"
    },
    {
      "name": "gl_branch",
      "alias": "gl_branch",
      "description": "Branch information and contact details"
    },
    {
      "name": "it_institute",
      "alias": "it_institute",
      "description": "Institute/company master information and registration details"
    },
    {
      "name": "it_generated_reports",
      "alias": "it_generated_reports",
      "description": "Generated report parameters, filters and metadata"
    },
    {
      "name": "it_user_master",
      "alias": "it_user_master",
      "description": "User master data for report generation and authorization"
    }
  ],
  "report_type": "personal_savings_ledger",
  "orientation": "portrait",
  "page_format": "A4",
  "business_purpose": "Personal savings account ledger showing customer details, account numbers, opening dates and current balances grouped by account type with sub-totals and grand totals",
  "key_features": [
    "Customer-centric layout with personal information",
    "Account type grouping with sub-totals",
    "Balance tracking with formatted currency display",
    "Multi-language support (Sinhala labels)",
    "Branch-specific filtering",
    "Account category filtering (savings accounts only)",
    "Opening date tracking",
    "Comprehensive totaling at multiple levels"
  ],
  "filtering_criteria": [
    {
      "field": "pl_month_tb.closing_balance",
      "condition": "<> 0",
      "description": "Only include accounts with non-zero closing balances"
    },
    {
      "field": "pl_account_type.pl_account_category_id",
      "condition": "= 1",
      "description": "Filter for savings account category only"
    },
    {
      "field": "pl_month_tb.branch_month_id",
      "condition": "= it_generated_reports.filter_2_value",
      "description": "Filter by specific branch month period"
    },
    {
      "field": "pl_account.gl_account_id",
      "condition": "= it_generated_reports.filter_1_value",
      "description": "Filter by specific general ledger account"
    },
    {
      "field": "pl_account.branch_id",
      "condition": "= it_generated_reports.branch_id",
      "description": "Filter by report generation branch"
    }
  ],
  "column_mappings": [
    {
      "column_name": "COLUMN_98",
      "actual_field": "pl_account_type.name_ln1",
      "description": "Account type name in local language"
    },
    {
      "column_name": "COLUMN_101",
      "actual_field": "gl_branch.name_ln1",
      "description": "Branch name in local language"
    }
  ]
}
